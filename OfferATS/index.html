<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>招聘自动化系统管理面板</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* 基础样式 */
     body {
  margin: 0;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  background: #f5f7fa;
  color: #333;
  display: flex;
  min-height: 100vh; /* 保证至少撑满屏幕 */
  align-items: stretch; /* 让子元素都撑满高度 */
}

nav {
  width: 220px;
  background: #004a9f;
  color: white;
  display: flex;
  flex-direction: column;
  padding-top: 20px;
  /* 去掉高度限制 */
  /* height: 100vh; */
  min-height: 100vh; /* 保证导航栏至少撑满视口高度 */
  box-sizing: border-box;
  overflow-y: auto;  /* 允许内容滚动，避免内容溢出被裁剪 */
}

    nav h2 {
      margin: 0 0 20px 20px;
      font-weight: 700;
      font-size: 1.4rem;
    }

    /* 内容区域 */
    main {
      flex-grow: 1;
      padding: 30px;
      overflow-y: auto;
    }
    main h1 {
      margin-top: 0;
      color: #004a9f;
    }
    section.module {
      display: none;
    }
    section.module.active {
      display: block;
    }
    /* 公共表单样式 */
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }
    input, select, textarea, button {
      margin-top: 6px;
      padding: 8px 12px;
      width: 100%;
      box-sizing: border-box;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }


    /* 日志区域 */

    #log {
  margin-top: 40px;
  background: #eaeef6;
  border-radius: 6px;
  padding: 10px 15px 5px 15px; /* 上下内边距调整，上面稍小，下面更小 */
  max-height: 180px;
  overflow-y: hidden;  /* 关闭滚动条 */
  font-size: 0.9rem;
  color: #555;
  white-space: pre-wrap;
  line-height: 1.4;     /* 可以调整行高，文字更紧凑 */
}


#candidate-profile label {
  display: block;
  margin-top: 8px;
  font-weight: 600;
  color: #333;
}

#candidate-profile input[type="email"],
#candidate-profile input[type="text"],
#candidate-profile textarea {
  width: 100%;
  padding: 8px 10px;
  margin-top: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  font-size: 14px;
}

/* 按钮统一基础样式 */
button {
  display: inline-block;
  padding: 10px 16px;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  background-color: #0078d4;
  color: white;
  width: auto;       /* 取消宽度100%，避免按钮过宽 */
  box-sizing: border-box;
  text-align: center;
}

/* 默认按钮 hover 效果 */
button:hover {
  background-color: #005ea2;
}

/* 侧边导航按钮特有 */
nav button {
  width: 100%;      /* 导航栏按钮撑满宽度 */
  text-align: left;
  background-color: transparent;
  color: white;
  padding: 15px 20px;
  font-weight: 400;
  border-left: 4px solid transparent;
  transition: background 0.3s ease, border-color 0.3s ease, font-weight 0.3s ease;
}

/* 侧边导航按钮 hover 和 active 状态 */
nav button:hover, nav button.active {
  background-color: #0063d1;
  border-left-color: #ffcc00;
  font-weight: 700;
}

/* 主体区域带 .primary 类的按钮 */
button.primary {
  background-color: #0078d4;
  color: white;
  border: none;
  width: auto;
  margin-top: 20px;
}

button.primary:hover {
  background-color: #005ea2;
}

/* #candidate-profile 模块特定按钮 */
#candidate-profile button {
  padding: 8px 16px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  margin-top: 12px;
  color: white;
  background-color: #0078d4;
  width: auto;
}

#candidate-profile button.primary {
  background-color: #0078d4;
}

#candidate-profile button.secondary {
  background-color: #f5f1e9;
  color: #7a6f4f;
  margin-left: 8px;
  border: 1px solid #d9d2bf;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

#candidate-profile button.secondary:hover {
  background-color: #f0eadc;
  border-color: #dcd5b8;
}

#candidate-profile button#callZapier {
  background-color: #e6f0ff;
  color: #1a2a5a;
  margin-left: 8px;
  border: 1px solid #a3b8ff;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

#candidate-profile button#callZapier:hover {
  background-color: #d7e4ff;
  border-color: #a3b8ff;
}




.chat-container {
  display: flex;
  flex-direction: column;
  height: 100vh; /* 或者你需要的固定高度 */
  background-color: #F7F8FC;
  overflow: hidden; /* 防止外部滚动 */
}

/* 聊天头部 */
.chat-header {
  flex-shrink: 0;
  height: auto;       /* 让高度自适应 */
  padding: 12px 20px; /* 适当增加左右内边距 */
  background-color: #6A4FB6;
  color: white;
  font-weight: 600;
  user-select: none;
  box-shadow: 0 2px 6px rgba(106, 79, 182, 0.4);
  position: relative;
  line-height: 1.4;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 4px;  /* 上下行间距 */
  font-size: 15px;
}


/* 消息区自动撑满剩余高度，且支持滚动 */
.chat-messages {
  flex: 1 1 auto;
  overflow-y: auto;
  background: white;
  padding: 16px;
  border-top: 1px solid #E5E3F4;
  border-bottom: 1px solid #E5E3F4;
  box-sizing: border-box;
  word-break: break-word;
}

/* 输入区固定高度，不允许伸缩 */
.chat-input {
  flex-shrink: 0;
  display: flex;
  padding: 12px 16px;
  background-color: #F7F8FC;
  border-top: 1px solid #E5E3F4;
  align-items: center;
  gap: 12px;
  height: 60px;
  box-sizing: border-box;
}

.chat-input input {
  flex-grow: 1;
  padding: 10px 14px;
  font-size: 16px;
  border: 1px solid #C3B7F0;
  border-radius: 20px;
  background-color: white;
  outline: none;
  transition: border-color 0.3s;
}

.chat-input input:focus {
  border-color: #8B6ECF;
}

.chat-input button {
  padding: 10px 20px;
  font-size: 16px;
  background-color: #6A4FB6;
  color: white;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(106, 79, 182, 0.4);
  flex-shrink: 0;
  transition: background-color 0.3s, box-shadow 0.3s;
}

.chat-input button:hover {
  background-color: #593aa5;
  box-shadow: 0 3px 8px rgba(89, 58, 165, 0.6);
}



  </style>
</head>
<body> 


<nav> 
  <h2>招聘自动化系统</h2>

  <button data-target="candidate-profile">邮箱验证</button>
  <button data-target="job-management">资料录入</button> 
  <button data-target="interview-schedule">面试通知</button>
  <button data-target="ai-screening">交流空间</button>
  <button data-target="candidate-database">候选资料库</button>
</nav>

<main>

  <!-- 模块 ① 邮箱验证 -->
  <section id="candidate-profile" class="module active">
    <h1>📧 邮箱验证</h1>
    <label for="partnerEmail">候选人邮箱（必填）</label>
    <input type="email" id="partnerEmail" name="email" placeholder="请输入邮箱" required />
    <button id="sendVerification">验证邮箱</button>
    <div id="formMessage" style="margin-top:12px; font-weight:500;"></div>
  </section>

  <!-- 模块 ② 资料录入 -->
  <section id="job-management" class="module">
    <h1>📝 资料录入</h1>
    <label for="email">候选人邮箱</label>
    <input type="email" id="email" placeholder="abc@example.com" required />
    <label for="jobTitle">岗位名称</label>
    <input type="text" id="jobTitle" placeholder="后端开发工程师" />
    <label for="resume">简历或备注</label>
    <textarea id="resume" rows="5" placeholder="简历内容..."></textarea>
    <button onclick="submitToZapier()">提交到Database</button>
    <div id="status"></div>
  </section>

  <!-- 模块 ③ 面试通知 -->
  <section id="interview-schedule" class="module">
    <h1>📅 面试安排通知</h1>
    <label for="interviewCandidate">候选人邮箱</label>
    <input type="email" id="interviewCandidate" placeholder="输入候选人邮箱" />
    <label for="interviewTime">面试时间</label>
    <input type="datetime-local" id="interviewTime" />
    <button class="primary" id="scheduleInterview">发送面试通知</button>
    <div id="interviewStatus" style="margin-top:12px;"></div>
  </section>




  <!-- 模块 ④ 交流空间 -->
  <section id="ai-screening" class="module">
    <h1>🗃️ 人才交流空间</h1>
    <p>快速连接潜在候选人，秒创交流空间，轻松联结人才，提升招聘效率。📈 

</p>

    <!-- 房间输入界面 -->
    <div id="roomEntry" style="margin-top:20px;">
      <div style="display:flex; gap: 10px; flex-wrap: wrap;">
        <input id="nameInput" placeholder="你的名字" style="flex:1; min-width:150px;"/>
        <input id="roomInput" placeholder="输入房间号" style="flex:1; min-width:150px;"/>
        <button id="joinBtn" class="primary" style="flex-shrink:0;">加入房间</button>
      </div>
    </div>

    <!-- 聊天界面 -->
    <div class="chat-container" id="chatContainer" style="display: none; margin-top: 20px; height: 400px; border: 1px solid #ccc; border-radius: 6px; background: white;">
      <div class="chat-header" style="flex-shrink: 0; padding: 12px 20px; background-color: #6A4FB6; color: white; font-weight: 600; user-select: none; box-shadow: 0 2px 6px rgba(106, 79, 182, 0.4); display: flex; flex-direction: column; gap: 4px; font-size: 15px; position: relative; line-height: 1.4;">
        <div style="display: flex; align-items: center;">
          <button id="callBtn" class="call-btn" title="语音通话" aria-label="语音通话" style="
            width: 32px;
            height: 32px;
            background-color: #8B6ECF;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 0;
            box-shadow: 0 2px 6px rgba(139, 110, 207, 0.6);">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#ffffff" viewBox="0 0 24 24">
              <path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.27 11.36 11.36 0 003.54.57 1 1 0 011 1V19a1 1 0 01-1 1A17 17 0 013 5a1 1 0 011-1h3.5a1 1 0 011 1 11.36 11.36 0 00.57 3.54 1 1 0 01-.27 1.11z"/>
            </svg>
          </button>
          <span style="font-size: 15px;">房间中（支持语音+文字）</span>
        </div>
        <div style="font-weight: 400; font-size: 13px; color: #D3C9F3;">
          🟢 在线 - <strong>abc</strong> 在房间 <strong>123</strong>
        </div>
        <span id="statusIndicator" style="display:none;"></span>
      </div>

      <div class="chat-messages" id="messages" style="flex: 1; overflow-y: auto; padding: 12px; font-size: 14px; color: #2B2346; background: #ECE8FF; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc;">
        <!-- 聊天内容 -->
      </div>
    </div>

    <div class="chat-input" style="padding:10px;">
      <input id="msgInput" placeholder="输入消息..." style="flex:1; padding:8px 12px; border-radius:6px; border:1px solid #C3B7F0; font-size:14px;" />
      <button id="sendBtn" class="primary" style="margin-left:10px; flex-shrink:0;">发送</button>
    </div>


<!-- 分享房间链接区域 -->
<div id="shareLinkContainer" style="margin-top: 20px; display: flex; align-items: center; gap: 10px; font-size: 13px; color: #888;">
  <label for="roomLinkInput" style="flex-shrink: 0;">分享房间链接：</label>
  <input id="roomLinkInput" type="password" readonly
         style="flex:1; padding: 6px; border-radius: 4px; border: 1px solid #eee; background: #f8f8f8; color: #aaa; font-size: 13px; user-select: all;" />
  <button id="copyLinkBtn" style="background: none; border: 1px solid #ddd; color: #666; padding: 5px 8px; border-radius: 4px; font-size: 13px;">
    复制链接
  </button>
</div>


</section>


  <!-- 模块 ⑤ 候选资料库 -->
  <section id="candidate-database" class="module">
    <h2>📂 候选人资料库</h2>
    <button onclick="loadResumes()">点击加载候选人列表</button>
    <div id="loading" class="loading" style="display:none;">正在加载数据，请稍候...</div>
    <table id="resumeTable" style="display: none;">
      <thead>
        <tr>
          <th>Email</th>
          <th>职位</th>
          <th>简历摘要</th>
          <th style="display:none;">Notion 页面</th>

        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- 日志面板 -->
  <div id="log" style="margin-top: 30px;">
    <h2>🧾 操作日志</h2>
    <pre id="logContent">暂无操作日志</pre>
  </div> 

</main>

  <script>  

 
document.getElementById("sendVerification").addEventListener("click", async () => {
  const email = document.getElementById("partnerEmail").value.trim();
  const formMessage = document.getElementById("formMessage");

  // 更严谨邮箱正则
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || !emailPattern.test(email)) {
    formMessage.textContent = "❌ 请输入有效的邮箱地址";
    formMessage.style.color = "red";
    return;
  }

  formMessage.textContent = "⏳ 正在发送验证邮件...";
  formMessage.style.color = "black";

  try {
    const res = await fetch("https://my-netlify-hof.app/.netlify/functions/partner-connect", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, name: "", userType: "candidate" }), // 如果需要可动态设置 name/userType
      mode: "cors"
    });

    const data = await res.json();

    if (res.ok) {
      formMessage.textContent = "✅ 验证邮件已发送，请查收";
      formMessage.style.color = "green";

      // 可选：3秒后清空提示
      setTimeout(() => {
        formMessage.textContent = "";
      }, 3000);
    } else {
      formMessage.textContent = "❌ 发送失败：" + (data.error || "未知错误");
      formMessage.style.color = "red";
    }

  } catch (err) {
    formMessage.textContent = "❌ 网络错误，请稍后重试";
    formMessage.style.color = "red";
    console.error("[邮箱验证错误]", err);
  }
});


 async function submitToZapier() {
      const email = document.getElementById('email').value.trim();
      const jobTitle = document.getElementById('jobTitle').value.trim();
      const resume = document.getElementById('resume').value.trim();
      const status = document.getElementById('status');

      if (!email || !email.includes('@')) {
        status.textContent = '❌ 请填写有效的邮箱地址';
        status.style.color = 'red';
        return;
      }

      status.textContent = '⏳ 正在提交，请稍候...';
      status.style.color = 'black';

      try {
        const res = await fetch('https://my-netlify-hof.netlify.app/.netlify/functions/partner-connect', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email,
            jobTitle,
            resume,
            action: 'callZapier'
          })
        });

        const result = await res.json();

        if (res.ok) {
          status.textContent = '✅ 成功录入Database';
          status.style.color = 'green';
        } else {
          status.textContent = '❌ 错误：' + (result.error || '未知错误');
          status.style.color = 'red';
        }

      } catch (err) {
        console.error('网络异常:', err);
        status.textContent = '❌ 网络异常，请稍后再试';
        status.style.color = 'red';
      }
    }




    async function loadResumes() {
      const loading = document.getElementById('loading');
      const table = document.getElementById('resumeTable');
      const tbody = table.querySelector('tbody');

      loading.style.display = 'block';
      table.style.display = 'none';
      tbody.innerHTML = '';


      try {
        const res = await fetch('https://my-netlify-hof.netlify.app/.netlify/functions/notion-query-all');
        const data = await res.json();

        if (!data.results || data.results.length === 0) {
          loading.innerText = '暂无数据';
          return;
        }

        data.results.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.email}</td>
            <td>${item.jobTitle}</td>
            <td>${item.resume}</td>
            <td style="display:none;"><a href="${item.notionUrl}" target="_blank">查看</a></td>

          `;
          tbody.appendChild(tr);
        });

        table.style.display = 'table';
        loading.style.display = 'none';
      } catch (err) {
        loading.innerText = '加载失败：' + err.message;
      }
    }



     // ✅ 模块切换逻辑
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('nav button[data-target]');
    const modules = document.querySelectorAll('main section.module');
    const allMainHeaders = document.querySelectorAll('main > h1');

    function showModule(targetId) {
      // 1. 激活按钮样式
      buttons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.target === targetId);
      });

      // 2. 显示对应 section.module，隐藏其他
      modules.forEach(section => {
        section.classList.toggle('active', section.id === targetId);
      });

      // 3. 隐藏所有 main 下的 h1（这些是模块标题）
      allMainHeaders.forEach(h => h.style.display = 'none');

      // 4. 显示当前模块内的标题（如果模块没有封装在 <section> 里就特殊处理）
      const targetSection = document.getElementById(targetId);
      if (!targetSection) return;

      // 若模块外部存在 h1（如邮箱验证/资料录入），也显示
      const h1sInside = targetSection.querySelectorAll('h1');
      h1sInside.forEach(h => h.style.display = 'block');
    }

    // 默认展示第一个模块（如果有）
    if (buttons.length > 0) {
      const firstTarget = buttons[0].dataset.target;
      showModule(firstTarget);
    }

    // 绑定按钮点击事件
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.dataset.target;
        showModule(targetId);
      });
    });
  });

    // 页面切换逻辑
  document.querySelectorAll("nav button").forEach(btn => {
    btn.addEventListener("click", () => {
      const targetId = btn.dataset.target;

      // 切换按钮样式
      document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      // 切换模块显示
      document.querySelectorAll("section.module").forEach(section => {
        if (section.id === targetId) {
          section.classList.add("active");
        } else {
          section.classList.remove("active");
        }
      });

      // 可选：记录日志
      const log = document.getElementById("logContent");
      if (log) {
        const timestamp = new Date().toLocaleTimeString();
        log.textContent = `[${timestamp}] 切换到模块：${btn.textContent}\n` + log.textContent;
      }
    });
  });




// 获取DOM元素
const roomEntry = document.getElementById('roomEntry');
const chatContainer = document.getElementById('chatContainer');
const joinBtn = document.getElementById('joinBtn');
const nameInput = document.getElementById('nameInput');
const roomInput = document.getElementById('roomInput');
const messages = document.getElementById('messages');
const msgInput = document.getElementById('msgInput');
const sendBtn = document.getElementById('sendBtn');
const statusIndicator = document.getElementById('statusIndicator');

const shareLinkContainer = document.getElementById('shareLinkContainer');
const roomLinkInput = document.getElementById('roomLinkInput');
const toggleLinkBtn = document.getElementById('toggleLinkBtn');
const copyLinkBtn = document.getElementById('copyLinkBtn');

joinBtn.onclick = () => {
  const name = nameInput.value.trim();
  const room = roomInput.value.trim();
  if (!name || !room) {
    alert('请输入名字和房间号');
    return;
  }

  // 隐藏加入房间界面，显示聊天界面
  roomEntry.style.display = 'none';
  chatContainer.style.display = 'flex';

  // 更新状态栏
  statusIndicator.textContent = `🟢 在线 - ${name} 在房间 ${room}`;

  // 显示欢迎消息
  messages.innerHTML = `<div><strong>系统：</strong> 欢迎 <em>${name}</em> 进入房间 <em>${room}</em>！</div>`;

  // 构造分享链接
  const shareUrl = `${window.location.origin}${window.location.pathname}?room=${encodeURIComponent(room)}&name=${encodeURIComponent(name)}`;
  roomLinkInput.value = shareUrl;

  // 显示分享链接区域
  shareLinkContainer.style.display = 'flex';

  // 隐藏显示/隐藏链接按钮
  toggleLinkBtn.style.display = 'none';

  // 复制按钮逻辑
  copyLinkBtn.onclick = () => {
    roomLinkInput.select();
    roomLinkInput.setSelectionRange(0, 99999);
    document.execCommand('copy');
    alert('房间链接已复制到剪贴板');
  };
};

// 发送消息
sendBtn.onclick = () => {
  const text = msgInput.value.trim();
  if (!text) return;
  const name = nameInput.value.trim() || '我';
  const msgDiv = document.createElement('div');
  msgDiv.textContent = `${name}: ${text}`;
  messages.appendChild(msgDiv);
  messages.scrollTop = messages.scrollHeight;
  msgInput.value = '';
  msgInput.focus();
};

// 支持回车发送
msgInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') sendBtn.click();
});


</script>

</body>

</html> 